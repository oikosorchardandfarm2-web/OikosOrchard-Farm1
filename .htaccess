# Oikos Orchard & Farm Security Configuration

# ====================
# DISABLE DIRECTORY LISTING
# ====================
Options -Indexes

# ====================
# SECURITY HEADERS
# ====================
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
Header set Referrer-Policy "strict-origin-when-cross-origin"

# ====================
# CONTENT SECURITY POLICY
# ====================
Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://embed.tawk.to https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://embed.tawk.to; img-src 'self' data: https: blob:; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com https://embed.tawk.to; connect-src 'self' https: ws: wss: https://embed.tawk.to; frame-src 'self' https://embed.tawk.to"

# ====================
# PROTECT CONFIG DIRECTORY
# ====================
<IfModule mod_rewrite.c>
    RewriteEngine On
    # Block direct access to config directory files
    RewriteRule ^config/ - [F,L]
    # Block access to sensitive files in root
    RewriteRule ^(\.env|\.git) - [F,L]
</IfModule>

# ====================
# BLOCK SENSITIVE FILE EXTENSIONS IN ROOT
# ====================
<FilesMatch "\.log$|\.txt$">
    Order allow,deny
    Deny from all
</FilesMatch>

# ====================
# PREVENT COMMON ATTACKS
# ====================
<IfModule mod_rewrite.c>
    # Block SQL injection attempts
    RewriteCond %{QUERY_STRING} (\=|%3D).*('|%27).*(union|select|insert|update|delete) [NC,OR]
    RewriteCond %{QUERY_STRING} (union|select|insert|update|delete).*(\=|%3D) [NC]
    RewriteRule ^(.*)$ - [F,L]

    # Block directory traversal
    RewriteCond %{REQUEST_URI} (\.\.\/|\.\.\\) [NC]
    RewriteRule ^(.*)$ - [F,L]
</IfModule>

# ====================
# COMPRESSION
# ====================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ====================
# CACHING
# ====================
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/html "access plus 1 day"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
</IfModule>


